<html>
  <head>
    <title>Logic proofs web interface - CS536</title>
    <script src="jsmain.js" type="text/javascript"></script>
    <script type="text/javascript">

      const examples = [["HW1 Task 2.2", "tauto.log"],
      ["HW1 Task 2.4", "uncurry.log"],
      ["HW1 Task 3.3", "pred.log"]
      ];
      const exbase = "examples/";

      var checked = false;
      var curex = -1;

      function selectEx() {
        curex = exbox.value;
        if (curex > -1) {
          filename.value = examples[curex][1];
          fetch(exbase + examples[curex][1])
            .then(resp => resp.text())
            .then((s) => { editor.setValue(s, -1); })
        } else {
          filename.value = "";
        }
        
      }
      
      function runCheck() {
        checked = false;
        document.getElementById('result').value = "Checking...";
      //pgm = document.getElementById('editor').value;
      pgm = editor.getValue();
      //pgm = logCheck.caml_string_of_jsbytes(pgm);
        document.getElementById('result').value = logCheck.check(pgm);
        var result = logCheck.lastResult("");
        if (result == 0) {
          checked = true;
          document.getElementById('result').style.backgroundColor = "#aaffbb";
        } else if (result == 1) 
          document.getElementById('result').style.backgroundColor = "#ffaaaa";
          else if (result == 2)
          document.getElementById('result').style.backgroundColor = "#ffffaa";
      }

      function clearResult() {
        checked = false;
        document.getElementById('result').value = "";
        document.getElementById('result').style.backgroundColor = "#ffffff";
      }

      //https://www.delftstack.com/howto/javascript/javascript-download/
      function download() {
        if (filename.value === "") {
          alert("ERROR: Filename is empty.");
          return;
        }
        if (!checked)
          alert("WARNING: You may want to check your proof before downloading it.");
        if ((curex > -1) && (filename.value != examples[curex][1]))
          alert("WARNING: Filename has been changed; homework proofs must be handed in with the original filename.");
        var fn = filename.value;
        var text = editor.getValue(); 
        var element = document.createElement('a');
        element.setAttribute('href','data:text/plain;charset=utf-8, ' + encodeURIComponent(text));
        element.setAttribute('download', fn);
        document.body.appendChild(element);
        element.click();
        document.body.removeChild(element);
     }
    </script>
    <script src="ace/src/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="version.js" type="text/javascript" charset="utf-8"></script>
  </head>
  <body>
    <!-- Basic editor
    <textarea id="editor" cols=80 rows=20>
      -->
    <div id="editor" style="position: absolute; width: 40%; height: 75%; border: solid black 1px; max-width: 95ch">// This is a comment. // Comments out exactly one line.
// We're proving that (P and Q) and R implies every combination.
// The first non-comment line must be the logical implication you're proving.
P /\ Q /\ R => (P /\ Q) /\ (Q /\ R) /\ (P /\ R)
// Blank lines don't count.

// The second non-comment line must be the assumption.
P /\ Q /\ R

// The following lines should have a (true) proposition followed by
// whitespace, with AT LEAST ONE TAB, followed by a justification.
// A justification is a rule name or abbreviation applied to line number(s).
// /\ is left-associative, so this requires associativity of /\.
P /\ (Q /\ R)						CommAssoc(8)
// If the fact you're using is the immediately previous one,
// you can leave out the line number.
P									Simplify
Q /\ R								Simplify(14)
// You can use the full rule name or the abbreviation.
Q									S
R									S(18)
// Multiple line numbers are separated by commas.
P /\ Q								Conj(17, 20)
Q /\ R								Conj(20, 21)
P /\ R								Conj(17, 21)
(P /\ Q) /\ (Q /\ R)				Conj(23, 24)
// The proof ends when you reach the goal.
(P /\ Q) /\ (Q /\ R) /\ (P /\ R)	Conj(26, 25)</div>
<!--
    </textarea>
-->
<div id="topcontrols" style="position: absolute; left: 45%; top: 25px;">
  <select name="exbox" id="exbox" onchange="selectEx()">
    <option value=-1>Select an Example</option>
  </select>
  &nbsp;&nbsp;&nbsp;
  Filename:
  <input type="text" name="filename" id="filename" size=15 />
  <button id="download" onclick="download()">Download</button>
</div>
<div id="rules" style="position: absolute; left: 45%; top: 75px;">
  <table border=0 cellspacing=3>
    <tr><td><b>Item</b></td><td><b>Syntax</b></td><td width=20>&nbsp;</td>
      <td><b>Item</b></td><td><b>Syntax</b></td></tr>
    <tr><td>Atomic Propositions</td><td>P</td><td>&nbsp;</td>
      <td>Conditional</td><td>p -> q</td>
    </tr>
    <tr>
      <td>Predicates</td><td>P(x)</td><td>&nbsp;</td>
      <td>Biconditional</td><td>p <-> q</td>
    </tr>
    <tr>
      <td>Negation</td><td>~p</td><td>&nbsp;</td>
      <td>Universal</td><td>Forall x. ...</td>
    </tr>
    <tr>
      <td>Conjunction</td><td>p /\ q</td><td>&nbsp;</td>
      <td>Existential</td><td>Exists x. ...</td>
    </tr>
    <tr>
      <td>Disjunction</td><td>p \/ q</td><td>&nbsp;</td>
    </tr>
    </table>
  <br />
  <br />
</div>
<div id="controls" style="position: absolute; top: 80%; left: 0; width: 40%; height: 20%;">
    <button id="check" onclick="runCheck()">Check</button>
    <textarea disabled id="result" style="width: 90%; height: 95%; background-color: #ffffff;" ></textarea>
</div>
<div id="version" style="position: absolute; bottom: 0; right: 0; font-size: 9pt">
<i>Checker compiled <script>document.write(compiled);</script></i>
</div>
    <script>
      var editor = ace.edit("editor");
      editor.setOption("useSoftTabs", false);
      editor.setOption("fontSize", 14);
    editor.setTheme("ace/theme/xcode");
      editor.session.setMode("ace/mode/logic");
      editor.session.on('change', (delta) => { clearResult(); });
      document.getElementById('rules').innerHTML += logCheck.rules();

      for (let i = 0; i < examples.length; i++)
	{
	exbox.innerHTML += '<option value=' + i + '>' + examples[i][0] + '</option>\\n';
	}
</script>
  </body>
</html>
